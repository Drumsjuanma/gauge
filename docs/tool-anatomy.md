## Anatomy of Gauge

* The entry point of the framework is `benchmark/<platform>/<benchmark_name>/simple.js`
* The tool depends on two types of configuration files namely `config.json` and `[blockchain].json` present in the benchmark/<platform_type>/<benchmark_name> directory.
* `config.json` (at some places the file is named as `config-<benchmark_name>.json`) contains the experiment related configuration settings, such as the type of experiment, number of rounds for each experiment, transaction send rate, and total transaction load.
* `[blockchain].json` defines blockchain related configuration settings. 


## Directory Structure
**Directory** | **Description**
------------------ | --------------
/benchmark | Samples of the blockchain benchmarks. It includes all the controlled workload & microbenchmark test scripts for Fabric and Quorum
/network | Fabric Crypto materials for the clients in the format generated by cryptogen tool.
/src | Source code of the Gauge framework tool
/listener | Block Event Listener code
/kafka-setup | Apache Kafka cluster & ZK ensemble set up script
/deployment-script | Deployment script to deploy chaincode and contracts
/docs | Documentation and Architecture 

## The config.json file
The documentation below explains the different parameters in the config.json file.
The explanation below is taken from the original [Caliper](https://github.com/Huawei-OSG/caliper/blob/master/docs/Architecture.md#configuration-file) source code with some modifications to it.

Below is a config.json file example:
```json
{
  "blockchain": {
    "type": "fabric",
    "config": "./fabric.json"
  },
  "test": {
    "type": "ONE_CHANNEL",
    "clients": 1,
    "rounds": [
      {
        "cmd": "open",
        "txNumbAndTps": [[500, 50],[500,50]],
        "arguments": [
          {
            "chaincodeid": "simple",
            "args": [{"fname": "open"},{"key": "accountno"},{"value": "1000"}]
          }
        ],
        "callback": "benchmark/simple/open-write-only.js"
      }
    ]
  },
  "monitor": {
    "type": "docker",
    "docker": {
      "name": ["http://0.0.0.0:2375/peer0.org1.example.com"]
    },
    "interval": 1
  }
}
```
* **blockchain** - defines the type of blockchain and the corresponding configuration file for Gauge to interact with. This is part of the original Caliper source, which was built to be extensible to work with any other blockchain by plugging in the adaptor for it. With Gauge, **blockchain.type** entry has to be set to "fabric" and **blockchain.config** has to point to the fabric.json configuration file, to be able to send transactions to the Fabric network.
* **test** - defines the number of clients to run the tests concurrently (recommendation is 1 per instance), as well as multiple test rounds, in each test round:
  * **type** : type of the experiment to be performed. Accepted String values are: 
    * ONE_CHANNEL for all the controlled workloads. 
    * MULTI_CHANNEL for channel scalability experiment.
    * MICRO_BENCHMARK for micro-benchmarking.
  * **cmd** :type of chaincode operation to be performed. Accepted String values are:
    * "open" for invoke (transaction)
    * "query" for query (non transaction operation i.e: proposal is not sent to the orderer)
  * **txNumbAndTps** : defines an array of sub-rounds with different transaction numbers or transaction generating speed. For example, [5000,400] means totally 5000 transactions will be generated and invoked at a speed of 400 transactions per second.
  * **arguments** : user defined arguments which will be passed directly to the user defined test module. arguments should have Chaincode ID, Chaincode version, payload set a chaincode would accept. The first element in the `args` should be the function name. In the above example the chaincode id is `simple`, function name is `open`, key is `accountno` and value is `1000`. For subsequent transactions,the framework will generate the key as accountno1, accountno2, etc.. with fixed value of 1000.
  * **callback** : specifies the user defined module used in this test round. Please see [User defined test module](#user-defined-test-module) to learn more details.
* **monitor** - defines the type of resource monitor and monitored objects, as well as the time interval for the monitoring.
  * docker : a docker monitor is used to monitor specified docker containers on local or remote hosts. Docker Remote API is used to retrieve remote container's stats. Reserved container name 'all' means all containers on the host will be watched. In above example, the monitor will retrieve the stats of two containers per second, one is a local container named 'peer0.org1.example.com' and another is a remote container named 'orderer.example.com' located on host '0.0.0.0', 2375 is the listening port of Docker on that host.
  * The syntax is `port://IP:docker_port/containerID`

### User defined test module
The user defined test module contains the below three functions

* `init` - Will be called by a child process at the beginning of the tests with a given blockchain object and context, as well as user defined arguments read from configuration file.
* `run` - The actual transactions are generated and invoked in here. The child process will call this function repeatedly according to assigned workload. The function will dynamically generate unique keys by appending an incremental index to the key passed through configuration file. In the above case, the keys will be in the range accountno_1, accountno_2, ..accountno_500 for each round.  
* `end` - Will be called by the child process when all the tests are finished, all the clearing work is implemented in here.

## The fabric.json file
For a description of how to set the fabric.json file, see the [fabric.json sample](./fabric-configuration.md)

## The quorum.json file
For a description of how to set the quorum.json file, see the [quorum.json sample](./quorum-configuration.md)



